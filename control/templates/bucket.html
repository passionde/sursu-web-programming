<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Gift Shop</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <div class="column-products">
      {% for product in products %}
      <div class="product">
        <div class="product-info">
            <h2>{{ product.name }}</h2>
            <p>{{ product.description }}</p>
            <p>
                {{ product.price }}‚ÇΩ
                <button class="btn btn-primary" onclick='addToCart({{ product.id }})'>+</button>
                <button class="btn btn-danger" onclick='removeFromCart({{ product.id }})'>-</button>
            </p>
        </div>
        <div class="product-img-wrap">
            <img class="product-img" src="{{ product.image_link }}" alt="–∫–∞—Ä—Ç–∏–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞ {{ product.name }}">
        </div>

      </div>
      {% endfor %}
    </div>
    <div class="column-cart">
      <div class="cart-wrap">
          <h2>–ö–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ üõí</h2>
          <ul id="cart">
            {% for item in cart %}
            <li>
                <button class="btn btn-primary" onclick='addToCart({{ item.id }})'>+</button>
                <button class="btn btn-danger" onclick='removeFromCart({{ item.id }})'>-</button>
                {{ item.name }}: {{ item.quantity }} x {{ item.price }}‚ÇΩ
            </li>
            {% endfor %}
          </ul>
          {% if cart %}
          <button class="btn btn-buy" onclick='orderBuy()'>–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          {% endif %}
          <button class="btn btn-buy" onclick='updateRow()'>–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
    <div class="form-popup" id="myForm">
      <form action="/order-commit" class="form-container">
        <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h1>
        <p class="message" id="messageID"></p>

        <label for="email"><b>–ü–æ—á—Ç–∞</b></label>
        <input type="text" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞" name="email" required>

        <label for="address"><b>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</b></label>
        <input type="text" placeholder="–ö—É–¥–∞ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑" name="address" required>

        <button type="submit" class="btn">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
        <button type="button" class="btn cancel" onclick="closeForm()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </form>
    </div>


<script>
function reqListener() {
    console.log(this.responseText);
}
function closeForm() {
  document.getElementById("myForm").style.display = "none";
}
function removeFromCart(product_id) {
    const req = new XMLHttpRequest();
    req.addEventListener('load', reqListener);
    req.open('GET', '/cart-del/'+product_id);
    req.send();
    location.reload()
}
function addToCart(product_id) {
    const req = new XMLHttpRequest();
    req.addEventListener('load', reqListener);
    req.open('GET', '/cart-add/'+product_id);
    req.send();
    location.reload()
}
function notificationAfterBuy() {
    if (this.responseText === "empty") {
        return;
    }
    document.getElementById("messageID").textContent = this.responseText;
    document.getElementById("myForm").style.display = "block";
}
function orderBuy() {
    const req = new XMLHttpRequest();
    req.addEventListener('load', notificationAfterBuy);
    req.open('GET', '/order-buy');
    req.send();
}
function updateRow() {
    const req = new XMLHttpRequest();
    req.addEventListener('load', reqListener);
    req.open('GET', '/update-row');
    req.send();
    location.reload()
}
</script>
</body>
</html>